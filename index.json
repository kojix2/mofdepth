{"repository_name":"mos","body":"# tanudepth\n\n[![build](https://github.com/kojix2/tanudepth/actions/workflows/build.yml/badge.svg)](https://github.com/kojix2/tanudepth/actions/workflows/build.yml)\n[![Lines of Code](https://img.shields.io/endpoint?url=https%3A%2F%2Ftokei.kojix2.net%2Fbadge%2Fgithub%2Fkojix2%2Ftanudepth%2Flines)](https://tokei.kojix2.net/github/kojix2/tanudepth)\n![Static Badge](https://img.shields.io/badge/PURE-VIBE_CODING-magenta)\n\nA fast BAM/CRAM depth calculation tool written in Crystal, inspired by [mosdepth](https://github.com/brentp/mosdepth).\n\n**This is an experiment to see if well-known tools can be ported to Crystal using “vibe coding”.**\n\n## Features\n\n- Fast depth calculation for BAM/CRAM files\n- Multiple processing modes (fast mode, fragment mode, CIGAR-based)\n- Per-base and region-based depth analysis\n- BED file support for custom regions\n- Window-based analysis\n- Comprehensive filtering options (MAPQ, fragment length, flags)\n\n## Installation\n\n### Prerequisites\n\n- Crystal\n- hts-lib (for BAM/CRAM support)\n\n### Build from source\n\n```bash\ngit clone https://github.com/kojix2/tanudepth\ncd tanudepth\nshards install\ncrystal build src/depth.cr --release\n```\n\n## Usage\n\n```bash\n./depth [options] <prefix> <BAM-or-CRAM>\n```\n\n### Basic example\n\n```bash\n./depth output sample.bam\n```\n\n### Options\n\n- `-t, --threads THREADS`: BAM decompression threads\n- `-c, --chrom CHROM`: Restrict to chromosome\n- `-b, --by BY`: BED file or numeric window size\n- `-n, --no-per-base`: Skip per-base output\n- `-Q, --mapq MAPQ`: MAPQ threshold\n- `-l, --min-frag-len MIN`: Minimum fragment length\n- `-u, --max-frag-len MAX`: Maximum fragment length\n- `-x, --fast-mode`: Fast mode (read start/end positions only)\n- `-a, --fragment-mode`: Count full fragment (proper pairs only)\n- `-m, --use-median`: Use median for region stats instead of mean\n- `-v, --version`: Show version\n- `-h, --help`: Show help message\n\n### Processing modes\n\n- **Default mode**: CIGAR-based depth calculation (most accurate)\n- **Fast mode** (`-x`): Uses read start/end positions (faster but less accurate)\n- **Fragment mode** (`-a`): Counts full fragments for paired-end reads\n\n**Note**: Fast mode and fragment mode cannot be used together.\n\n### Output files\n\n- `<prefix>.depth.summary.txt`: Per-chromosome summary statistics\n- `<prefix>.per-base.bed`: Per-base depth (unless `-n` is used)\n- `<prefix>.depth.global.dist.txt`: Global depth distribution\n- `<prefix>.regions.bed`: Region-based statistics (when using `-b`)\n- `<prefix>.depth.region.dist.txt`: Region depth distribution (when using `-b`)\n\n### Summary file format\n\nThe summary file contains the following columns:\n\n- `chrom`: Chromosome name\n- `length`: Chromosome length\n- `sum_depth`: Total depth (sum of all depths)\n- `mean`: Mean depth\n- `min`: Minimum depth\n- `max`: Maximum depth\n\n## Examples\n\n### Basic depth calculation\n\n```bash\n./depth output sample.bam\n```\n\n### With BED regions\n\n```bash\n./depth -b regions.bed output sample.bam\n```\n\n### Window-based analysis (1kb windows)\n\n```bash\n./depth -b 1000 output sample.bam\n```\n\n### Fast mode with MAPQ filtering\n\n```bash\n./depth -x -Q 20 output sample.bam\n```\n\n### Fragment mode for paired-end data\n\n```bash\n./depth -a -l 100 -u 1000 output sample.bam\n```\n\n## License\n\nMIT License\n","program":{"html_id":"mos/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"mos","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"mos/Depth","path":"Depth.html","kind":"module","full_name":"Depth","name":"Depth","abstract":false,"locations":[{"filename":"src/depth.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth.cr#L7"},{"filename":"src/depth/config.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L4"},{"filename":"src/depth/core/types.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L1"},{"filename":"src/depth/errors.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L1"},{"filename":"src/depth/runner.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/runner.cr#L12"},{"filename":"src/depth/version.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/version.cr#L1"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.0.0\""}],"types":[{"html_id":"mos/Depth/BamIndexError","path":"Depth/BamIndexError.html","kind":"class","full_name":"Depth::BamIndexError","name":"BamIndexError","abstract":false,"superclass":{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L12"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/CLI","path":"Depth/CLI.html","kind":"class","full_name":"Depth::CLI","name":"CLI","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth.cr#L8"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"run(args=ARGV)-class-method","name":"run","abstract":false,"args":[{"name":"args","default_value":"ARGV","external_name":"args","restriction":""}],"args_string":"(args = ARGV)","args_html":"(args = <span class=\"t\">ARGV</span>)","location":{"filename":"src/depth.cr","line_number":9,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth.cr#L9"},"def":{"name":"run","args":[{"name":"args","default_value":"ARGV","external_name":"args","restriction":""}],"visibility":"Public","body":"config = Configuration.new\nconfig.prefix = \"out\"\n\nOptionParser.parse(args) do |psr|\n  psr.banner = \"Usage: depth [options] <prefix> <BAM-or-CRAM>\"\n\n  psr.on(\"-t\", \"--threads THREADS\", \"BAM decompression threads\") do |v| config.threads = v.to_i end\n  psr.on(\"-c\", \"--chrom CHROM\", \"Restrict to chromosome\") do |v| config.chrom = v end\n  psr.on(\"-b\", \"--by BY\", \"BED file or numeric window size\") do |v| config.by = v end\n  psr.on(\"-n\", \"--no-per-base\", \"Skip per-base output\") do config.no_per_base = true end\n  psr.on(\"-Q\", \"--mapq MAPQ\", \"MAPQ threshold\") do |v| config.mapq = v.to_i end\n  psr.on(\"-l\", \"--min-frag-len MIN\", \"Minimum fragment length\") do |v| config.min_frag_len = v.to_i end\n  psr.on(\"-u\", \"--max-frag-len MAX\", \"Maximum fragment length\") do |v| config.max_frag_len = v.to_i end\n  psr.on(\"-x\", \"--fast-mode\", \"Fast mode\") do config.fast_mode = true end\n  psr.on(\"-a\", \"--fragment-mode\", \"Count full fragment (proper pairs only)\") do config.fragment_mode = true end\n  psr.on(\"-m\", \"--use-median\", \"Use median for region stats instead of mean\") do config.use_median = true end\n  psr.on(\"-q\", \"--quantize QUANTIZE\", \"Write quantized output (e.g., 0:1:4:)\") do |v| config.quantize = v end\n  psr.on(\"-v\", \"--version\", \"Show version\") do   puts(Depth::VERSION)\n  exit(0)\n end\n  psr.on(\"-h\", \"--help\", \"Show this message\") do   puts(psr)\n  exit(0)\n end\n\n  psr.invalid_option do |opt|\n    STDERR.puts(\"Error: unknown option: #{opt}\")\n    STDERR.puts(\"Use --help for usage information\")\n    exit(1)\n  end\nend\n\nif ARGV.size < 2\n  STDERR.puts(\"Error: missing arguments: <prefix> <BAM-or-CRAM>\")\n  STDERR.puts(\"Use --help for usage information\")\n  exit(2)\nend\n\nconfig.prefix = ARGV[0]\nconfig.path = ARGV[1]\n\nbegin\n  runner = Runner.new(config)\n  runner.run\nrescue ex : ConfigurationError\n  STDERR.puts(\"Configuration error: #{ex.message}\")\n  exit(1)\nrescue ex : FileNotFoundError\n  STDERR.puts(\"File not found: #{ex.message}\")\n  exit(1)\nrescue ex : BamIndexError\n  STDERR.puts(\"Index error: #{ex.message}\")\n  exit(1)\nrescue ex : Exception\n  STDERR.puts(\"Error: #{ex.message}\")\n  exit(1)\nend\n"},"external_var":false}]},{"html_id":"mos/Depth/Configuration","path":"Depth/Configuration.html","kind":"class","full_name":"Depth::Configuration","name":"Configuration","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/config.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L5"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"instance_methods":[{"html_id":"bed_path:String|Nil-instance-method","name":"bed_path","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":56,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L56"},"def":{"name":"bed_path","return_type":"String | ::Nil","visibility":"Public","body":"if has_regions?\nelse\n  return nil\nend\nif by.each_char.all?(&.ascii_number?)\n  return nil\nend\nby\n"},"external_var":false},{"html_id":"by:String-instance-method","name":"by","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":10,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L10"},"def":{"name":"by","return_type":"String","visibility":"Public","body":"@by"},"external_var":false},{"html_id":"by=(by:String)-instance-method","name":"by=","abstract":false,"args":[{"name":"by","external_name":"by","restriction":"String"}],"args_string":"(by : String)","args_html":"(by : String)","location":{"filename":"src/depth/config.cr","line_number":10,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L10"},"def":{"name":"by=","args":[{"name":"by","external_name":"by","restriction":"String"}],"visibility":"Public","body":"@by = by"},"external_var":false},{"html_id":"chrom:String-instance-method","name":"chrom","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":9,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L9"},"def":{"name":"chrom","return_type":"String","visibility":"Public","body":"@chrom"},"external_var":false},{"html_id":"chrom=(chrom:String)-instance-method","name":"chrom=","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"}],"args_string":"(chrom : String)","args_html":"(chrom : String)","location":{"filename":"src/depth/config.cr","line_number":9,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L9"},"def":{"name":"chrom=","args":[{"name":"chrom","external_name":"chrom","restriction":"String"}],"visibility":"Public","body":"@chrom = chrom"},"external_var":false},{"html_id":"fast_mode:Bool-instance-method","name":"fast_mode","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":15,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L15"},"def":{"name":"fast_mode","return_type":"Bool","visibility":"Public","body":"@fast_mode"},"external_var":false},{"html_id":"fast_mode=(fast_mode:Bool)-instance-method","name":"fast_mode=","abstract":false,"args":[{"name":"fast_mode","external_name":"fast_mode","restriction":"Bool"}],"args_string":"(fast_mode : Bool)","args_html":"(fast_mode : Bool)","location":{"filename":"src/depth/config.cr","line_number":15,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L15"},"def":{"name":"fast_mode=","args":[{"name":"fast_mode","external_name":"fast_mode","restriction":"Bool"}],"visibility":"Public","body":"@fast_mode = fast_mode"},"external_var":false},{"html_id":"fragment_mode:Bool-instance-method","name":"fragment_mode","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":16,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L16"},"def":{"name":"fragment_mode","return_type":"Bool","visibility":"Public","body":"@fragment_mode"},"external_var":false},{"html_id":"fragment_mode=(fragment_mode:Bool)-instance-method","name":"fragment_mode=","abstract":false,"args":[{"name":"fragment_mode","external_name":"fragment_mode","restriction":"Bool"}],"args_string":"(fragment_mode : Bool)","args_html":"(fragment_mode : Bool)","location":{"filename":"src/depth/config.cr","line_number":16,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L16"},"def":{"name":"fragment_mode=","args":[{"name":"fragment_mode","external_name":"fragment_mode","restriction":"Bool"}],"visibility":"Public","body":"@fragment_mode = fragment_mode"},"external_var":false},{"html_id":"has_quantize?:Bool-instance-method","name":"has_quantize?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":62,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L62"},"def":{"name":"has_quantize?","return_type":"Bool","visibility":"Public","body":"!quantize.empty? && (quantize != \"nil\")"},"external_var":false},{"html_id":"has_regions?:Bool-instance-method","name":"has_regions?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":46,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L46"},"def":{"name":"has_regions?","return_type":"Bool","visibility":"Public","body":"!by.empty?"},"external_var":false},{"html_id":"mapq:Int32-instance-method","name":"mapq","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L12"},"def":{"name":"mapq","return_type":"Int32","visibility":"Public","body":"@mapq"},"external_var":false},{"html_id":"mapq=(mapq:Int32)-instance-method","name":"mapq=","abstract":false,"args":[{"name":"mapq","external_name":"mapq","restriction":"Int32"}],"args_string":"(mapq : Int32)","args_html":"(mapq : Int32)","location":{"filename":"src/depth/config.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L12"},"def":{"name":"mapq=","args":[{"name":"mapq","external_name":"mapq","restriction":"Int32"}],"visibility":"Public","body":"@mapq = mapq"},"external_var":false},{"html_id":"max_frag_len:Int32-instance-method","name":"max_frag_len","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":14,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L14"},"def":{"name":"max_frag_len","return_type":"Int32","visibility":"Public","body":"@max_frag_len"},"external_var":false},{"html_id":"max_frag_len=(max_frag_len:Int32)-instance-method","name":"max_frag_len=","abstract":false,"args":[{"name":"max_frag_len","external_name":"max_frag_len","restriction":"Int32"}],"args_string":"(max_frag_len : Int32)","args_html":"(max_frag_len : Int32)","location":{"filename":"src/depth/config.cr","line_number":14,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L14"},"def":{"name":"max_frag_len=","args":[{"name":"max_frag_len","external_name":"max_frag_len","restriction":"Int32"}],"visibility":"Public","body":"@max_frag_len = max_frag_len"},"external_var":false},{"html_id":"min_frag_len:Int32-instance-method","name":"min_frag_len","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":13,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L13"},"def":{"name":"min_frag_len","return_type":"Int32","visibility":"Public","body":"@min_frag_len"},"external_var":false},{"html_id":"min_frag_len=(min_frag_len:Int32)-instance-method","name":"min_frag_len=","abstract":false,"args":[{"name":"min_frag_len","external_name":"min_frag_len","restriction":"Int32"}],"args_string":"(min_frag_len : Int32)","args_html":"(min_frag_len : Int32)","location":{"filename":"src/depth/config.cr","line_number":13,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L13"},"def":{"name":"min_frag_len=","args":[{"name":"min_frag_len","external_name":"min_frag_len","restriction":"Int32"}],"visibility":"Public","body":"@min_frag_len = min_frag_len"},"external_var":false},{"html_id":"no_per_base:Bool-instance-method","name":"no_per_base","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":11,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L11"},"def":{"name":"no_per_base","return_type":"Bool","visibility":"Public","body":"@no_per_base"},"external_var":false},{"html_id":"no_per_base=(no_per_base:Bool)-instance-method","name":"no_per_base=","abstract":false,"args":[{"name":"no_per_base","external_name":"no_per_base","restriction":"Bool"}],"args_string":"(no_per_base : Bool)","args_html":"(no_per_base : Bool)","location":{"filename":"src/depth/config.cr","line_number":11,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L11"},"def":{"name":"no_per_base=","args":[{"name":"no_per_base","external_name":"no_per_base","restriction":"Bool"}],"visibility":"Public","body":"@no_per_base = no_per_base"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L7"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"@path"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/depth/config.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L7"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"@path = path"},"external_var":false},{"html_id":"prefix:String-instance-method","name":"prefix","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L6"},"def":{"name":"prefix","return_type":"String","visibility":"Public","body":"@prefix"},"external_var":false},{"html_id":"prefix=(prefix:String)-instance-method","name":"prefix=","abstract":false,"args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"args_string":"(prefix : String)","args_html":"(prefix : String)","location":{"filename":"src/depth/config.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L6"},"def":{"name":"prefix=","args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"visibility":"Public","body":"@prefix = prefix"},"external_var":false},{"html_id":"quantize:String-instance-method","name":"quantize","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":19,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L19"},"def":{"name":"quantize","return_type":"String","visibility":"Public","body":"@quantize"},"external_var":false},{"html_id":"quantize=(quantize:String)-instance-method","name":"quantize=","abstract":false,"args":[{"name":"quantize","external_name":"quantize","restriction":"String"}],"args_string":"(quantize : String)","args_html":"(quantize : String)","location":{"filename":"src/depth/config.cr","line_number":19,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L19"},"def":{"name":"quantize=","args":[{"name":"quantize","external_name":"quantize","restriction":"String"}],"visibility":"Public","body":"@quantize = quantize"},"external_var":false},{"html_id":"quantize_args:Array(Int32)-instance-method","name":"quantize_args","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":66,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L66"},"def":{"name":"quantize_args","return_type":"Array(Int32)","visibility":"Public","body":"if has_quantize?\nelse\n  return [] of Int32\nend\nStats::Quantize.get_quantize_args(quantize)\n"},"external_var":false},{"html_id":"threads:Int32-instance-method","name":"threads","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L8"},"def":{"name":"threads","return_type":"Int32","visibility":"Public","body":"@threads"},"external_var":false},{"html_id":"threads=(threads:Int32)-instance-method","name":"threads=","abstract":false,"args":[{"name":"threads","external_name":"threads","restriction":"Int32"}],"args_string":"(threads : Int32)","args_html":"(threads : Int32)","location":{"filename":"src/depth/config.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L8"},"def":{"name":"threads=","args":[{"name":"threads","external_name":"threads","restriction":"Int32"}],"visibility":"Public","body":"@threads = threads"},"external_var":false},{"html_id":"thresholds:Array(Int32)-instance-method","name":"thresholds","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":18,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L18"},"def":{"name":"thresholds","return_type":"Array(Int32)","visibility":"Public","body":"@thresholds"},"external_var":false},{"html_id":"thresholds=(thresholds:Array(Int32))-instance-method","name":"thresholds=","abstract":false,"args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"args_string":"(thresholds : Array(Int32))","args_html":"(thresholds : Array(Int32))","location":{"filename":"src/depth/config.cr","line_number":18,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L18"},"def":{"name":"thresholds=","args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"visibility":"Public","body":"@thresholds = thresholds"},"external_var":false},{"html_id":"to_options:Core::Options-instance-method","name":"to_options","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":36,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L36"},"def":{"name":"to_options","return_type":"Core::Options","visibility":"Public","body":"Core::Options.new(mapq: mapq, min_frag_len: min_frag_len, max_frag_len: (max_frag_len < 0 ? Int32::MAX : max_frag_len), fast_mode: fast_mode, fragment_mode: fragment_mode)"},"external_var":false},{"html_id":"use_median:Bool-instance-method","name":"use_median","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":17,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L17"},"def":{"name":"use_median","return_type":"Bool","visibility":"Public","body":"@use_median"},"external_var":false},{"html_id":"use_median=(use_median:Bool)-instance-method","name":"use_median=","abstract":false,"args":[{"name":"use_median","external_name":"use_median","restriction":"Bool"}],"args_string":"(use_median : Bool)","args_html":"(use_median : Bool)","location":{"filename":"src/depth/config.cr","line_number":17,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L17"},"def":{"name":"use_median=","args":[{"name":"use_median","external_name":"use_median","restriction":"Bool"}],"visibility":"Public","body":"@use_median = use_median"},"external_var":false},{"html_id":"validate!-instance-method","name":"validate!","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":21,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L21"},"def":{"name":"validate!","visibility":"Public","body":"if path.empty?\n  raise(ArgumentError.new(\"BAM/CRAM path is required\"))\nend\nif prefix.empty?\n  raise(ArgumentError.new(\"Output prefix is required\"))\nend\nif mapq < 0\n  raise(ArgumentError.new(\"Invalid MAPQ threshold\"))\nend\nif threads < 0\n  raise(ArgumentError.new(\"Invalid thread count\"))\nend\n\nif (min_frag_len >= 0 && max_frag_len >= 0) && min_frag_len > max_frag_len\n  raise(ArgumentError.new(\"min_frag_len cannot be greater than max_frag_len\"))\nend\n\nif fast_mode && fragment_mode\n  raise(ArgumentError.new(\"--fast-mode and --fragment-mode cannot be used together\"))\nend\n"},"external_var":false},{"html_id":"window_size:Int32-instance-method","name":"window_size","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":50,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/config.cr#L50"},"def":{"name":"window_size","return_type":"Int32","visibility":"Public","body":"if has_regions?\nelse\n  return 0\nend\nif by.each_char.all?(&.ascii_number?)\nelse\n  return 0\nend\nby.to_i\n"},"external_var":false}]},{"html_id":"mos/Depth/ConfigurationError","path":"Depth/ConfigurationError.html","kind":"class","full_name":"Depth::ConfigurationError","name":"ConfigurationError","abstract":false,"superclass":{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":10,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L10"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/Core","path":"Depth/Core.html","kind":"module","full_name":"Depth::Core","name":"Core","abstract":false,"locations":[{"filename":"src/depth/core/cigar.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L3"},{"filename":"src/depth/core/coverage_calculator.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/coverage_calculator.cr#L5"},{"filename":"src/depth/core/types.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L1"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"MAX_COVERAGE","name":"MAX_COVERAGE","value":"400000"},{"id":"UNKNOWN_CHROM_TID","name":"UNKNOWN_CHROM_TID","value":"-999"}],"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"types":[{"html_id":"mos/Depth/Core/Cigar","path":"Depth/Core/Cigar.html","kind":"module","full_name":"Depth::Core::Cigar","name":"Cigar","abstract":false,"locations":[{"filename":"src/depth/core/cigar.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L4"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"cigar_start_end_events(cigar,ipos:Int32):Array(Tuple(Int32,Int32))-instance-method","name":"cigar_start_end_events","doc":"CIGAR → start/end events on reference\nReturns array of {pos, +1/-1}; pos is 0-based ref coordinate","summary":"<p>CIGAR → start/end events on reference Returns array of {pos, +1/-1}; pos is 0-based ref coordinate</p>","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"args_string":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","args_html":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","location":{"filename":"src/depth/core/cigar.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L7"},"def":{"name":"cigar_start_end_events","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"return_type":"Array(Tuple(Int32, Int32))","visibility":"Public","body":"events = [] of Tuple(Int32, Int32)\n\npos = ipos\nlast_stop = -1\ncigar.each do |op_char, olen|\n\n  consumes_ref = ['M', 'D', 'N', '=', 'X'].includes?(op_char)\n  if consumes_ref\n  else\n    next\n  end\n\n\n  consumes_query = ['M', 'I', 'S', '=', 'X'].includes?(op_char)\n  if consumes_query\n    if pos != last_stop\n      events << {pos, 1}\n      if last_stop >= 0\n        events << {last_stop, -1}\n      end\n    end\n    last_stop = pos + olen.to_i32\n  end\n  pos = pos + olen.to_i32\nend\nif last_stop >= 0\n  events << {last_stop, -1}\nend\nevents\n"},"external_var":false},{"html_id":"inc_coverage(cigar,ipos:Int32,a:Coverage)-instance-method","name":"inc_coverage","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"a","external_name":"a","restriction":"Coverage"}],"args_string":"(cigar, ipos : Int32, a : Coverage)","args_html":"(cigar, ipos : Int32, a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>)","location":{"filename":"src/depth/core/cigar.cr","line_number":32,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L32"},"def":{"name":"inc_coverage","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"a","external_name":"a","restriction":"Coverage"}],"visibility":"Public","body":"(cigar_start_end_events(cigar, ipos)).each do |pos, val|\n  if pos < 0 || a.empty?\n    next\n  end\n  p = pos.clamp(0, a.size - 1)\n  __temp_151 = p\n  a[__temp_151] = a[__temp_151] + val\nend"},"external_var":false}]},{"html_id":"mos/Depth/Core/Coverage","path":"Depth/Core/Coverage.html","kind":"alias","full_name":"Depth::Core::Coverage","name":"Coverage","abstract":false,"locations":[{"filename":"src/depth/core/types.cr","line_number":39,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L39"}],"repository_name":"mos","program":false,"enum":false,"alias":true,"aliased":"Array(Int32)","aliased_html":"Array(Int32)","const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"}},{"html_id":"mos/Depth/Core/CoverageBuilder","path":"Depth/Core/CoverageBuilder.html","kind":"class","full_name":"Depth::Core::CoverageBuilder","name":"CoverageBuilder","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/coverage_calculator.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/coverage_calculator.cr#L6"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"mos/Depth/Core/Cigar","kind":"module","full_name":"Depth::Core::Cigar","name":"Cigar"},{"html_id":"mos/Depth/Core/CoverageUtils","kind":"module","full_name":"Depth::Core::CoverageUtils","name":"CoverageUtils"}],"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(bam:HTS::Bam,options:Options)-class-method","name":"new","abstract":false,"args":[{"name":"bam","external_name":"bam","restriction":"HTS::Bam"},{"name":"options","external_name":"options","restriction":"Options"}],"args_string":"(bam : HTS::Bam, options : Options)","args_html":"(bam : HTS::Bam, options : <a href=\"../../Depth/Core/Options.html\">Options</a>)","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":10,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/coverage_calculator.cr#L10"},"def":{"name":"new","args":[{"name":"bam","external_name":"bam","restriction":"HTS::Bam"},{"name":"options","external_name":"options","restriction":"Options"}],"visibility":"Public","body":"_ = allocate\n_.initialize(bam, options)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"calculate(a:Coverage,r:Region|Nil):Int32-instance-method","name":"calculate","doc":"Returns: CoverageResult enum values or tid","summary":"<p>Returns: CoverageResult enum values or tid</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"r","external_name":"r","restriction":"Region | ::Nil"}],"args_string":"(a : Coverage, r : Region | Nil) : Int32","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, r : <a href=\"../../Depth/Core/Region.html\">Region</a> | Nil) : Int32","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":116,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/coverage_calculator.cr#L116"},"def":{"name":"calculate","args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"r","external_name":"r","restriction":"Region | ::Nil"}],"return_type":"Int32","visibility":"Public","body":"tid = CoverageResult::ChromNotFound.value\nif r\n  tid = @bam.header.get_tid(r.chrom)\nelse\n  tid = CoverageResult::AllChroms.value\nend\n\nif tid == CoverageResult::ChromNotFound.value\n  return CoverageResult::ChromNotFound.value\nend\n\nfound, chrom_tid = if r && tid >= 0\n  process_region_query(a, r, tid)\nelse\n  process_full_scan(a, tid)\nend\n\nif found\nelse\n  return CoverageResult::NoData.value\nend\ntid >= 0 ? tid : chrom_tid\n"},"external_var":false},{"html_id":"initialize_coverage_array(coverage:Coverage,chrom_len:Int32)-instance-method","name":"initialize_coverage_array","doc":"Initialize coverage array for a chromosome","summary":"<p>Initialize coverage array for a chromosome</p>","abstract":false,"args":[{"name":"coverage","external_name":"coverage","restriction":"Coverage"},{"name":"chrom_len","external_name":"chrom_len","restriction":"Int32"}],"args_string":"(coverage : Coverage, chrom_len : Int32)","args_html":"(coverage : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, chrom_len : Int32)","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":55,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/coverage_calculator.cr#L55"},"def":{"name":"initialize_coverage_array","args":[{"name":"coverage","external_name":"coverage","restriction":"Coverage"},{"name":"chrom_len","external_name":"chrom_len","restriction":"Int32"}],"visibility":"Public","body":"coverage.clear\ncoverage.concat(Array.new(chrom_len + 1, 0))\n"},"external_var":false}]},{"html_id":"mos/Depth/Core/CoverageResult","path":"Depth/Core/CoverageResult.html","kind":"enum","full_name":"Depth::Core::CoverageResult","name":"CoverageResult","abstract":false,"ancestors":[{"html_id":"mos/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"mos/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"mos/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/types.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L5"}],"repository_name":"mos","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"ChromNotFound","name":"ChromNotFound","value":"-1"},{"id":"NoData","name":"NoData","value":"-2"},{"id":"AllChroms","name":"AllChroms","value":"-42"}],"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"all_chroms?-instance-method","name":"all_chroms?","doc":"Returns `true` if this enum value equals `AllChroms`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#AllChroms\">AllChroms</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L8"},"def":{"name":"all_chroms?","visibility":"Public","body":"self == AllChroms"},"external_var":false},{"html_id":"chrom_not_found?-instance-method","name":"chrom_not_found?","doc":"Returns `true` if this enum value equals `ChromNotFound`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#ChromNotFound\">ChromNotFound</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L6"},"def":{"name":"chrom_not_found?","visibility":"Public","body":"self == ChromNotFound"},"external_var":false},{"html_id":"no_data?-instance-method","name":"no_data?","doc":"Returns `true` if this enum value equals `NoData`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#NoData\">NoData</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L7"},"def":{"name":"no_data?","visibility":"Public","body":"self == NoData"},"external_var":false}]},{"html_id":"mos/Depth/Core/CoverageUtils","path":"Depth/Core/CoverageUtils.html","kind":"module","full_name":"Depth::Core::CoverageUtils","name":"CoverageUtils","abstract":false,"locations":[{"filename":"src/depth/core/cigar.cr","line_number":41,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L41"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"each_constant_segment(a:Coverage,stop_at:Int32=-1,&)-instance-method","name":"each_constant_segment","doc":"Yield intervals [start, stop) with constant depth value","summary":"<p>Yield intervals [start, stop) with constant depth value</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"stop_at","default_value":"-1","external_name":"stop_at","restriction":"Int32"}],"args_string":"(a : Coverage, stop_at : Int32 = -1, &)","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, stop_at : Int32 = <span class=\"n\">-1</span>, &)","location":{"filename":"src/depth/core/cigar.cr","line_number":54,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L54"},"def":{"name":"each_constant_segment","args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"stop_at","default_value":"-1","external_name":"stop_at","restriction":"Int32"}],"yields":1,"block_arity":1,"visibility":"Public","body":"if a.size <= 1\n  return\nend\n\nlast_depth = Int32::MIN\nlast_i = 0\ni = 0\nstop = stop_at <= 0 ? a.size - 1 : stop_at\n\nwhile i < stop\n  depth = a[i]\n  if depth == last_depth\n    i = i + 1\n    next\n  end\n\n  if last_depth != Int32::MIN\n    yield({last_i, i, last_depth})\n  end\n  last_depth = depth\n  last_i = i\n\n  if (i + 1) == stop\n    break\n  end\n  i = i + 1\nend\n\nif last_i < stop\n  yield({last_i, a.size - 1, last_depth})\nelsif last_i != i\n  yield({last_i - 1, i, last_depth})\nelse\n  yield({last_i, i, last_depth})\nend\n"},"external_var":false},{"html_id":"prefix_sum!(a:Coverage)-instance-method","name":"prefix_sum!","doc":"Utility function for cumulative sum","summary":"<p>Utility function for cumulative sum</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"}],"args_string":"(a : Coverage)","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>)","location":{"filename":"src/depth/core/cigar.cr","line_number":43,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/cigar.cr#L43"},"def":{"name":"prefix_sum!","args":[{"name":"a","external_name":"a","restriction":"Coverage"}],"visibility":"Public","body":"sum = 0\ni = 0\nwhile i < a.size\n  sum = sum + a[i]\n  a[i] = sum\n  i = i + 1\nend\n"},"external_var":false}]},{"html_id":"mos/Depth/Core/Options","path":"Depth/Core/Options.html","kind":"struct","full_name":"Depth::Core::Options","name":"Options","abstract":false,"superclass":{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mos/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/types.cr","line_number":41,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L41"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(mapq:Int32=0,min_frag_len:Int32=-1,max_frag_len:Int32=Int32::MAX,exclude_flag:UInt16=1796_u16,include_flag:UInt16=0_u16,fast_mode:Bool=false,fragment_mode:Bool=false,read_groups:Array(String)=[]ofString)-class-method","name":"new","abstract":false,"args":[{"name":"mapq","default_value":"0","external_name":"mapq","restriction":"Int32"},{"name":"min_frag_len","default_value":"-1","external_name":"min_frag_len","restriction":"Int32"},{"name":"max_frag_len","default_value":"Int32::MAX","external_name":"max_frag_len","restriction":"Int32"},{"name":"exclude_flag","default_value":"1796_u16","external_name":"exclude_flag","restriction":"UInt16"},{"name":"include_flag","default_value":"0_u16","external_name":"include_flag","restriction":"UInt16"},{"name":"fast_mode","default_value":"false","external_name":"fast_mode","restriction":"Bool"},{"name":"fragment_mode","default_value":"false","external_name":"fragment_mode","restriction":"Bool"},{"name":"read_groups","default_value":"[] of String","external_name":"read_groups","restriction":"Array(String)"}],"args_string":"(mapq : Int32 = 0, min_frag_len : Int32 = -1, max_frag_len : Int32 = Int32::MAX, exclude_flag : UInt16 = 1796_u16, include_flag : UInt16 = 0_u16, fast_mode : Bool = false, fragment_mode : Bool = false, read_groups : Array(String) = [] of String)","args_html":"(mapq : Int32 = <span class=\"n\">0</span>, min_frag_len : Int32 = <span class=\"n\">-1</span>, max_frag_len : Int32 = <span class=\"t\">Int32</span><span class=\"t\">::</span><span class=\"t\">MAX</span>, exclude_flag : UInt16 = <span class=\"n\">1796_u16</span>, include_flag : UInt16 = <span class=\"n\">0_u16</span>, fast_mode : Bool = <span class=\"n\">false</span>, fragment_mode : Bool = <span class=\"n\">false</span>, read_groups : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>)","location":{"filename":"src/depth/core/types.cr","line_number":41,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L41"},"def":{"name":"new","args":[{"name":"mapq","default_value":"0","external_name":"mapq","restriction":"Int32"},{"name":"min_frag_len","default_value":"-1","external_name":"min_frag_len","restriction":"Int32"},{"name":"max_frag_len","default_value":"Int32::MAX","external_name":"max_frag_len","restriction":"Int32"},{"name":"exclude_flag","default_value":"1796_u16","external_name":"exclude_flag","restriction":"UInt16"},{"name":"include_flag","default_value":"0_u16","external_name":"include_flag","restriction":"UInt16"},{"name":"fast_mode","default_value":"false","external_name":"fast_mode","restriction":"Bool"},{"name":"fragment_mode","default_value":"false","external_name":"fragment_mode","restriction":"Bool"},{"name":"read_groups","default_value":"[] of String","external_name":"read_groups","restriction":"Array(String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(mapq, min_frag_len, max_frag_len, exclude_flag, include_flag, fast_mode, fragment_mode, read_groups)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":41,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L41"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@mapq.clone, @min_frag_len.clone, @max_frag_len.clone, @exclude_flag.clone, @include_flag.clone, @fast_mode.clone, @fragment_mode.clone, @read_groups.clone)"},"external_var":false},{"html_id":"copy_with(mapq_mapq=@mapq,min_frag_len_min_frag_len=@min_frag_len,max_frag_len_max_frag_len=@max_frag_len,exclude_flag_exclude_flag=@exclude_flag,include_flag_include_flag=@include_flag,fast_mode_fast_mode=@fast_mode,fragment_mode_fragment_mode=@fragment_mode,read_groups_read_groups=@read_groups)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_mapq","default_value":"@mapq","external_name":"mapq","restriction":""},{"name":"_min_frag_len","default_value":"@min_frag_len","external_name":"min_frag_len","restriction":""},{"name":"_max_frag_len","default_value":"@max_frag_len","external_name":"max_frag_len","restriction":""},{"name":"_exclude_flag","default_value":"@exclude_flag","external_name":"exclude_flag","restriction":""},{"name":"_include_flag","default_value":"@include_flag","external_name":"include_flag","restriction":""},{"name":"_fast_mode","default_value":"@fast_mode","external_name":"fast_mode","restriction":""},{"name":"_fragment_mode","default_value":"@fragment_mode","external_name":"fragment_mode","restriction":""},{"name":"_read_groups","default_value":"@read_groups","external_name":"read_groups","restriction":""}],"args_string":"(mapq _mapq = @mapq, min_frag_len _min_frag_len = @min_frag_len, max_frag_len _max_frag_len = @max_frag_len, exclude_flag _exclude_flag = @exclude_flag, include_flag _include_flag = @include_flag, fast_mode _fast_mode = @fast_mode, fragment_mode _fragment_mode = @fragment_mode, read_groups _read_groups = @read_groups)","args_html":"(mapq _mapq = @mapq, min_frag_len _min_frag_len = @min_frag_len, max_frag_len _max_frag_len = @max_frag_len, exclude_flag _exclude_flag = @exclude_flag, include_flag _include_flag = @include_flag, fast_mode _fast_mode = @fast_mode, fragment_mode _fragment_mode = @fragment_mode, read_groups _read_groups = @read_groups)","location":{"filename":"src/depth/core/types.cr","line_number":41,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L41"},"def":{"name":"copy_with","args":[{"name":"_mapq","default_value":"@mapq","external_name":"mapq","restriction":""},{"name":"_min_frag_len","default_value":"@min_frag_len","external_name":"min_frag_len","restriction":""},{"name":"_max_frag_len","default_value":"@max_frag_len","external_name":"max_frag_len","restriction":""},{"name":"_exclude_flag","default_value":"@exclude_flag","external_name":"exclude_flag","restriction":""},{"name":"_include_flag","default_value":"@include_flag","external_name":"include_flag","restriction":""},{"name":"_fast_mode","default_value":"@fast_mode","external_name":"fast_mode","restriction":""},{"name":"_fragment_mode","default_value":"@fragment_mode","external_name":"fragment_mode","restriction":""},{"name":"_read_groups","default_value":"@read_groups","external_name":"read_groups","restriction":""}],"visibility":"Public","body":"self.class.new(_mapq, _min_frag_len, _max_frag_len, _exclude_flag, _include_flag, _fast_mode, _fragment_mode, _read_groups)"},"external_var":false},{"html_id":"exclude_flag:UInt16-instance-method","name":"exclude_flag","abstract":false,"def":{"name":"exclude_flag","return_type":"UInt16","visibility":"Public","body":"@exclude_flag"},"external_var":false},{"html_id":"fast_mode:Bool-instance-method","name":"fast_mode","abstract":false,"def":{"name":"fast_mode","return_type":"Bool","visibility":"Public","body":"@fast_mode"},"external_var":false},{"html_id":"fragment_mode:Bool-instance-method","name":"fragment_mode","abstract":false,"def":{"name":"fragment_mode","return_type":"Bool","visibility":"Public","body":"@fragment_mode"},"external_var":false},{"html_id":"include_flag:UInt16-instance-method","name":"include_flag","abstract":false,"def":{"name":"include_flag","return_type":"UInt16","visibility":"Public","body":"@include_flag"},"external_var":false},{"html_id":"mapq:Int32-instance-method","name":"mapq","abstract":false,"def":{"name":"mapq","return_type":"Int32","visibility":"Public","body":"@mapq"},"external_var":false},{"html_id":"max_frag_len:Int32-instance-method","name":"max_frag_len","abstract":false,"def":{"name":"max_frag_len","return_type":"Int32","visibility":"Public","body":"@max_frag_len"},"external_var":false},{"html_id":"min_frag_len:Int32-instance-method","name":"min_frag_len","abstract":false,"def":{"name":"min_frag_len","return_type":"Int32","visibility":"Public","body":"@min_frag_len"},"external_var":false},{"html_id":"read_groups:Array(String)-instance-method","name":"read_groups","abstract":false,"def":{"name":"read_groups","return_type":"Array(String)","visibility":"Public","body":"@read_groups"},"external_var":false}]},{"html_id":"mos/Depth/Core/Region","path":"Depth/Core/Region.html","kind":"struct","full_name":"Depth::Core::Region","name":"Region","abstract":false,"superclass":{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mos/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/types.cr","line_number":20,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L20"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(chrom:String,start:Int32,stop:Int32,name:String|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"}],"args_string":"(chrom : String, start : Int32, stop : Int32, name : String | Nil = nil)","args_html":"(chrom : String, start : Int32, stop : Int32, name : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/depth/core/types.cr","line_number":26,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L26"},"def":{"name":"new","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(chrom, start, stop, name)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"chrom:String-instance-method","name":"chrom","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":21,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L21"},"def":{"name":"chrom","return_type":"String","visibility":"Public","body":"@chrom"},"external_var":false},{"html_id":"name:String|Nil-instance-method","name":"name","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":24,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L24"},"def":{"name":"name","return_type":"String | ::Nil","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"start:Int32-instance-method","name":"start","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L22"},"def":{"name":"start","return_type":"Int32","visibility":"Public","body":"@start"},"external_var":false},{"html_id":"stop:Int32-instance-method","name":"stop","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":23,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L23"},"def":{"name":"stop","return_type":"Int32","visibility":"Public","body":"@stop"},"external_var":false},{"html_id":"to_s(io)-instance-method","name":"to_s","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/depth/core/types.cr","line_number":30,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L30"},"def":{"name":"to_s","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"if name\n  ((((((io << chrom) << \":\") << (start + 1)) << \"-\") << stop) << \"\\t\") << name\nelse\n  ((((io << chrom) << \":\") << (start + 1)) << \"-\") << stop\nend"},"external_var":false}]},{"html_id":"mos/Depth/Core/Target","path":"Depth/Core/Target.html","kind":"struct","full_name":"Depth::Core::Target","name":"Target","abstract":false,"superclass":{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mos/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/types.cr","line_number":11,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L11"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(name:String,length:Int32,tid:Int32)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"length","external_name":"length","restriction":"Int32"},{"name":"tid","external_name":"tid","restriction":"Int32"}],"args_string":"(name : String, length : Int32, tid : Int32)","args_html":"(name : String, length : Int32, tid : Int32)","location":{"filename":"src/depth/core/types.cr","line_number":16,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L16"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"length","external_name":"length","restriction":"Int32"},{"name":"tid","external_name":"tid","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, length, tid)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"length:Int32-instance-method","name":"length","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":13,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L13"},"def":{"name":"length","return_type":"Int32","visibility":"Public","body":"@length"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L12"},"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"tid:Int32-instance-method","name":"tid","abstract":false,"location":{"filename":"src/depth/core/types.cr","line_number":14,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/core/types.cr#L14"},"def":{"name":"tid","return_type":"Int32","visibility":"Public","body":"@tid"},"external_var":false}]}]},{"html_id":"mos/Depth/CoverageCalculationError","path":"Depth/CoverageCalculationError.html","kind":"class","full_name":"Depth::CoverageCalculationError","name":"CoverageCalculationError","abstract":false,"superclass":{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L8"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/Error","path":"Depth/Error.html","kind":"class","full_name":"Depth::Error","name":"Error","abstract":false,"superclass":{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":2,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L2"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"mos/Depth/BamIndexError","kind":"class","full_name":"Depth::BamIndexError","name":"BamIndexError"},{"html_id":"mos/Depth/ConfigurationError","kind":"class","full_name":"Depth::ConfigurationError","name":"ConfigurationError"},{"html_id":"mos/Depth/CoverageCalculationError","kind":"class","full_name":"Depth::CoverageCalculationError","name":"CoverageCalculationError"},{"html_id":"mos/Depth/FileNotFoundError","kind":"class","full_name":"Depth::FileNotFoundError","name":"FileNotFoundError"},{"html_id":"mos/Depth/InvalidRegionError","kind":"class","full_name":"Depth::InvalidRegionError","name":"InvalidRegionError"}],"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/FileIO","path":"Depth/FileIO.html","kind":"module","full_name":"Depth::FileIO","name":"FileIO","abstract":false,"locations":[{"filename":"src/depth/io/bed_reader.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/bed_reader.cr#L3"},{"filename":"src/depth/io/output_manager.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L3"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"parse_region_str(s:String):Depth::Core::Region|Nil-class-method","name":"parse_region_str","doc":"Parse region like: chr1, chr1:100-200, or BED line","summary":"<p>Parse region like: chr1, chr1:100-200, or BED line</p>","abstract":false,"args":[{"name":"s","external_name":"s","restriction":"String"}],"args_string":"(s : String) : Depth::Core::Region | Nil","args_html":"(s : String) : <a href=\"../Depth/Core/Region.html\">Depth::Core::Region</a> | Nil","location":{"filename":"src/depth/io/bed_reader.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/bed_reader.cr#L5"},"def":{"name":"parse_region_str","args":[{"name":"s","external_name":"s","restriction":"String"}],"return_type":"Depth::Core::Region | ::Nil","visibility":"Public","body":"if s.empty? || (s == \"nil\")\n  return nil\nend\nif s.includes?(':')\n  chrom, rest = s.split(\":\", 2)\n  if rest.includes?('-')\n    st, ed = rest.split('-', 2)\n    Depth::Core::Region.new(chrom, st.to_i - 1, ed.to_i)\n  else\n    Depth::Core::Region.new(chrom, rest.to_i - 1, rest.to_i)\n  end\nelse\n  Depth::Core::Region.new(s, 0, 0)\nend\n"},"external_var":false},{"html_id":"read_bed(path:String):Hash(String,Array(Depth::Core::Region))-class-method","name":"read_bed","doc":"BED reader → {chrom => [Region]}","summary":"<p>BED reader → {chrom =&gt; [Region]}</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Hash(String, Array(Depth::Core::Region))","args_html":"(path : String) : Hash(String, Array(<a href=\"../Depth/Core/Region.html\">Depth::Core::Region</a>))","location":{"filename":"src/depth/io/bed_reader.cr","line_number":21,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/bed_reader.cr#L21"},"def":{"name":"read_bed","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Hash(String, Array(Depth::Core::Region))","visibility":"Public","body":"tbl = Hash(String, Array(Depth::Core::Region)).new do |h, k| h[k] = [] of Depth::Core::Region end\nFile.each_line(path) do |line|\n  if (line.starts_with?(\"#\")) || line.empty?\n    next\n  end\n  if line.starts_with?(\"track \")\n    next\n  end\n  cols = line.rstrip.split('\\t')\n  if cols.size < 3\n    STDERR.puts(\"[depth] skipping bad bed line: #{line}\")\n    next\n  end\n  chrom = cols[0]\n  s = cols[1].to_i\n  e = cols[2].to_i\n  name = cols.size > 3 ? cols[3].strip : nil\n  tbl[chrom] << (Depth::Core::Region.new(chrom, s, e, name))\nend\n\ntbl.each_value(&.sort_by!(&.start))\ntbl\n"},"external_var":false}],"types":[{"html_id":"mos/Depth/FileIO/OutputManager","path":"Depth/FileIO/OutputManager.html","kind":"class","full_name":"Depth::FileIO::OutputManager","name":"OutputManager","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/io/output_manager.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L4"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/FileIO","kind":"module","full_name":"Depth::FileIO","name":"FileIO"},"constructors":[{"html_id":"new(prefix:String)-class-method","name":"new","abstract":false,"args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"args_string":"(prefix : String)","args_html":"(prefix : String)","location":{"filename":"src/depth/io/output_manager.cr","line_number":13,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L13"},"def":{"name":"new","args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(prefix)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"close_all-instance-method","name":"close_all","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":65,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L65"},"def":{"name":"close_all","visibility":"Public","body":"[@f_summary, @f_global, @f_region, @f_perbase, @f_regions, @f_quantized].each(&.try(&.close))"},"external_var":false},{"html_id":"create_files(no_per_base:Bool=false,has_regions:Bool=false,has_quantize:Bool=false)-instance-method","name":"create_files","abstract":false,"args":[{"name":"no_per_base","default_value":"false","external_name":"no_per_base","restriction":"Bool"},{"name":"has_regions","default_value":"false","external_name":"has_regions","restriction":"Bool"},{"name":"has_quantize","default_value":"false","external_name":"has_quantize","restriction":"Bool"}],"args_string":"(no_per_base : Bool = false, has_regions : Bool = false, has_quantize : Bool = false)","args_html":"(no_per_base : Bool = <span class=\"n\">false</span>, has_regions : Bool = <span class=\"n\">false</span>, has_quantize : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/depth/io/output_manager.cr","line_number":24,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L24"},"def":{"name":"create_files","args":[{"name":"no_per_base","default_value":"false","external_name":"no_per_base","restriction":"Bool"},{"name":"has_regions","default_value":"false","external_name":"has_regions","restriction":"Bool"},{"name":"has_quantize","default_value":"false","external_name":"has_quantize","restriction":"Bool"}],"visibility":"Public","body":"@f_summary = File.open(\"#{@prefix}.depth.summary.txt\", \"w\")\n@f_global = File.open(\"#{@prefix}.depth.global.dist.txt\", \"w\")\n@f_region = has_regions ? File.open(\"#{@prefix}.depth.region.dist.txt\", \"w\") : nil\n@f_perbase = no_per_base ? nil : File.open(\"#{@prefix}.per-base.bed\", \"w\")\n@f_regions = has_regions ? File.open(\"#{@prefix}.regions.bed\", \"w\") : nil\n@f_quantized = has_quantize ? File.open(\"#{@prefix}.quantized.bed\", \"w\") : nil\n"},"external_var":false},{"html_id":"f_global:File?-instance-method","name":"f_global","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_global","visibility":"Public","body":"@f_global"},"external_var":false},{"html_id":"f_perbase:File?-instance-method","name":"f_perbase","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_perbase","visibility":"Public","body":"@f_perbase"},"external_var":false},{"html_id":"f_quantized:File?-instance-method","name":"f_quantized","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_quantized","visibility":"Public","body":"@f_quantized"},"external_var":false},{"html_id":"f_region:File?-instance-method","name":"f_region","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_region","visibility":"Public","body":"@f_region"},"external_var":false},{"html_id":"f_regions:File?-instance-method","name":"f_regions","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_regions","visibility":"Public","body":"@f_regions"},"external_var":false},{"html_id":"f_summary:File?-instance-method","name":"f_summary","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":22,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L22"},"def":{"name":"f_summary","visibility":"Public","body":"@f_summary"},"external_var":false},{"html_id":"write_per_base_interval(chrom:String,start:Int32,stop:Int32,depth:Int32)-instance-method","name":"write_per_base_interval","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"depth","external_name":"depth","restriction":"Int32"}],"args_string":"(chrom : String, start : Int32, stop : Int32, depth : Int32)","args_html":"(chrom : String, start : Int32, stop : Int32, depth : Int32)","location":{"filename":"src/depth/io/output_manager.cr","line_number":46,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L46"},"def":{"name":"write_per_base_interval","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"depth","external_name":"depth","restriction":"Int32"}],"visibility":"Public","body":"if @f_perbase\nelse\n  return\nend\n(((((((@f_perbase.not_nil! << chrom) << \"\\t\") << start) << \"\\t\") << stop) << \"\\t\") << depth) << \"\\n\"\n"},"external_var":false},{"html_id":"write_quantized_interval(chrom:String,start:Int32,stop:Int32,label:String)-instance-method","name":"write_quantized_interval","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"label","external_name":"label","restriction":"String"}],"args_string":"(chrom : String, start : Int32, stop : Int32, label : String)","args_html":"(chrom : String, start : Int32, stop : Int32, label : String)","location":{"filename":"src/depth/io/output_manager.cr","line_number":60,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L60"},"def":{"name":"write_quantized_interval","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"label","external_name":"label","restriction":"String"}],"visibility":"Public","body":"if @f_quantized\nelse\n  return\nend\n(((((((@f_quantized.not_nil! << chrom) << \"\\t\") << start) << \"\\t\") << stop) << \"\\t\") << label) << \"\\n\"\n"},"external_var":false},{"html_id":"write_region_stat(chrom:String,start:Int32,stop:Int32,name:String|Nil,value:Float64)-instance-method","name":"write_region_stat","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"value","external_name":"value","restriction":"Float64"}],"args_string":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, value : Float64)","args_html":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, value : Float64)","location":{"filename":"src/depth/io/output_manager.cr","line_number":51,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L51"},"def":{"name":"write_region_stat","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"value","external_name":"value","restriction":"Float64"}],"visibility":"Public","body":"if @f_regions\nelse\n  return\nend\nif name\n  (((((((((@f_regions.not_nil! << chrom) << \"\\t\") << start) << \"\\t\") << stop) << \"\\t\") << name) << \"\\t\") << value) << \"\\n\"\nelse\n  (((((((@f_regions.not_nil! << chrom) << \"\\t\") << start) << \"\\t\") << stop) << \"\\t\") << value) << \"\\n\"\nend\n"},"external_var":false},{"html_id":"write_summary_line(region:String,stat:Depth::Stats::DepthStat)-instance-method","name":"write_summary_line","abstract":false,"args":[{"name":"region","external_name":"region","restriction":"String"},{"name":"stat","external_name":"stat","restriction":"Depth::Stats::DepthStat"}],"args_string":"(region : String, stat : Depth::Stats::DepthStat)","args_html":"(region : String, stat : <a href=\"../../Depth/Stats/DepthStat.html\">Depth::Stats::DepthStat</a>)","location":{"filename":"src/depth/io/output_manager.cr","line_number":33,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/io/output_manager.cr#L33"},"def":{"name":"write_summary_line","args":[{"name":"region","external_name":"region","restriction":"String"},{"name":"stat","external_name":"stat","restriction":"Depth::Stats::DepthStat"}],"visibility":"Public","body":"if @f_summary\nelse\n  return\nend\n\nif @header_written\nelse\n  (@f_summary.not_nil! << ([\"chrom\", \"length\", \"sum_depth\", \"mean\", \"min\", \"max\"].join(\"\\t\"))) << '\\n'\n  @header_written = true\nend\n\nmean = stat.n_bases > 0 ? stat.sum_depth.to_f / stat.n_bases : 0.0\nminv = stat.min_depth == Int32::MAX ? 0 : stat.min_depth\n(@f_summary.not_nil! << ([region, stat.n_bases, stat.sum_depth, mean, minv, stat.max_depth].join(\"\\t\"))) << '\\n'\n"},"external_var":false}]}]},{"html_id":"mos/Depth/FileNotFoundError","path":"Depth/FileNotFoundError.html","kind":"class","full_name":"Depth::FileNotFoundError","name":"FileNotFoundError","abstract":false,"superclass":{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L4"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/InvalidRegionError","path":"Depth/InvalidRegionError.html","kind":"class","full_name":"Depth::InvalidRegionError","name":"InvalidRegionError","abstract":false,"superclass":{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mos/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mos/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/errors.cr#L6"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mos/Depth/Runner","path":"Depth/Runner.html","kind":"class","full_name":"Depth::Runner","name":"Runner","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/runner.cr","line_number":13,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/runner.cr#L13"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"mos/Depth/Core/CoverageUtils","kind":"module","full_name":"Depth::Core::CoverageUtils","name":"CoverageUtils"},{"html_id":"mos/Depth/Stats/Distribution","kind":"module","full_name":"Depth::Stats::Distribution","name":"Distribution"}],"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"constructors":[{"html_id":"new(config:Configuration)-class-method","name":"new","abstract":false,"args":[{"name":"config","external_name":"config","restriction":"Configuration"}],"args_string":"(config : Configuration)","args_html":"(config : <a href=\"../Depth/Configuration.html\">Configuration</a>)","location":{"filename":"src/depth/runner.cr","line_number":17,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/runner.cr#L17"},"def":{"name":"new","args":[{"name":"config","external_name":"config","restriction":"Configuration"}],"visibility":"Public","body":"_ = allocate\n_.initialize(config)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"run-instance-method","name":"run","abstract":false,"location":{"filename":"src/depth/runner.cr","line_number":20,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/runner.cr#L20"},"def":{"name":"run","visibility":"Public","body":"@config.validate!\n\n\nbam = HTS::Bam.open(@config.path, threads: @config.threads)\nbegin\n  bam.load_index\nrescue ex\n  raise(\"Failed to load index for #{@config.path}: #{ex.message}\")\nend\n\nregion = FileIO.parse_region_str(@config.chrom)\nopts = @config.to_options\n\n\noutput = FileIO::OutputManager.new(@config.prefix)\noutput.create_files(@config.no_per_base, @config.has_regions?, @config.has_quantize?)\n\nbegin\n  target_names = bam.header.target_names\n  target_lengths = bam.header.target_len\n  targets = target_names.map_with_index do |name, i|\n    Core::Target.new(name, target_lengths[i].to_i32, i)\n  end\n\n  sub_targets = if region\n    targets.select do |t| t.name == region.not_nil!.chrom end\n  else\n    targets\n  end\n\n\n  global_dist = Array(Int64).new(512, 0_i64)\n  region_dist = Array(Int64).new(512, 0_i64)\n  global_stat = Stats::DepthStat.new\n  cs = Stats::IntHistogram.new(@config.use_median ? 65536 : 0)\n\n\n  bed_map : Hash(String, Array(Core::Region)) | ::Nil = nil\n  window = @config.window_size\n  if bed_path = @config.bed_path\n    bed_map = FileIO.read_bed(bed_path)\n  end\n\n\n  calculator = Core::CoverageBuilder.new(bam, opts)\n\n\n  sub_targets.each_with_index do |t, idx|\n\n    if (@config.no_per_base && bed_map) && !(bed_map.not_nil!.has_key?(t.name))\n      next\n    end\n\n    coverage = Core::Coverage.new(t.length + 1, 0)\n\n\n    query_region = if region && (t.name == region.not_nil!.chrom)\n      region.not_nil!\n    else\n      Core::Region.new(t.name, 0, 0)\n    end\n\n    tid = calculator.calculate(coverage, query_region)\n    if tid == Core::CoverageResult::ChromNotFound.value\n      next\n    end\n\n    if tid != Core::CoverageResult::NoData.value\n      self.class.prefix_sum!(coverage)\n    end\n\n\n    if output.f_perbase\n      if tid == Core::CoverageResult::NoData.value\n        output.write_per_base_interval(t.name, 0, t.length, 0)\n      else\n        self.class.each_constant_segment(coverage) do |__temp_140|\n          s, e, v = __temp_140\n          output.write_per_base_interval(t.name, s, e, v)\n        end\n      end\n    end\n\n\n    if output.f_quantized && @config.has_quantize?\n      process_quantized(t, coverage, tid, output)\n    end\n\n\n    if output.f_regions\n      process_regions(t, coverage, tid, window, bed_map, cs, output, region_dist)\n    end\n\n\n    if tid != Core::CoverageResult::NoData.value\n      self.class.bump_distribution!(global_dist, coverage, 0, coverage.size - 1)\n      chrom_stat = Stats::DepthStat.from_array(coverage, 0, coverage.size - 2)\n      global_stat = global_stat + chrom_stat\n      output.write_summary_line(t.name, chrom_stat)\n    end\n\n\n    if f_global = output.f_global\n      self.class.write_distribution(f_global.as(::IO), t.name, global_dist)\n    end\n    if f_region = output.f_region\n      self.class.write_distribution(f_region.as(::IO), t.name, region_dist)\n      region_dist.fill(0_i64)\n    end\n    global_dist.fill(0_i64)\n  end\nensure\n  output.close_all\nend\n"},"external_var":false}]},{"html_id":"mos/Depth/Stats","path":"Depth/Stats.html","kind":"module","full_name":"Depth::Stats","name":"Stats","abstract":false,"locations":[{"filename":"src/depth/stats/count_stat.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L1"},{"filename":"src/depth/stats/depth_stat.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L1"},{"filename":"src/depth/stats/distribution.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/distribution.cr#L3"},{"filename":"src/depth/stats/quantize.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L1"},{"filename":"src/depth/stats/threshold.cr","line_number":1,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/threshold.cr#L1"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"threshold_args(ts:String):Array(Int32)-class-method","name":"threshold_args","doc":"Parse threshold arguments string like \"1,2,3\" into array of integers","summary":"<p>Parse threshold arguments string like &quot;1,2,3&quot; into array of integers</p>","abstract":false,"args":[{"name":"ts","external_name":"ts","restriction":"String"}],"args_string":"(ts : String) : Array(Int32)","args_html":"(ts : String) : Array(Int32)","location":{"filename":"src/depth/stats/threshold.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/threshold.cr#L3"},"def":{"name":"threshold_args","args":[{"name":"ts","external_name":"ts","restriction":"String"}],"return_type":"Array(Int32)","visibility":"Public","body":"if ts.empty? || (ts == \"nil\")\n  return [] of Int32\nend\n\nbegin\n  result = (ts.split(',')).map(&.to_i)\n  result.sort!\n  result\nrescue ArgumentError\n  raise(ArgumentError.new(\"Invalid threshold string: '#{ts}'\"))\nend\n"},"external_var":false}],"types":[{"html_id":"mos/Depth/Stats/DepthStat","path":"Depth/Stats/DepthStat.html","kind":"struct","full_name":"Depth::Stats::DepthStat","name":"DepthStat","abstract":false,"superclass":{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mos/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mos/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L2"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"class_methods":[{"html_id":"from_array(array:Array(Int32),start_idx:Int32=0,end_idx:Int32=-1)-class-method","name":"from_array","abstract":false,"args":[{"name":"array","external_name":"array","restriction":"Array(Int32)"},{"name":"start_idx","default_value":"0","external_name":"start_idx","restriction":"Int32"},{"name":"end_idx","default_value":"-1","external_name":"end_idx","restriction":"Int32"}],"args_string":"(array : Array(Int32), start_idx : Int32 = 0, end_idx : Int32 = -1)","args_html":"(array : Array(Int32), start_idx : Int32 = <span class=\"n\">0</span>, end_idx : Int32 = <span class=\"n\">-1</span>)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":26,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L26"},"def":{"name":"from_array","args":[{"name":"array","external_name":"array","restriction":"Array(Int32)"},{"name":"start_idx","default_value":"0","external_name":"start_idx","restriction":"Int32"},{"name":"end_idx","default_value":"-1","external_name":"end_idx","restriction":"Int32"}],"visibility":"Public","body":"s = DepthStat.new\nif end_idx < 0\n  end_idx = array.size - 1\nend\ns.n_bases = (end_idx - start_idx) + 1\n(start_idx..end_idx).each do |i|\n  v = array[i]\n  s.sum_depth = s.sum_depth + v\n  if v < s.min_depth\n    s.min_depth = v\n  end\n  if v > s.max_depth\n    s.max_depth = v\n  end\nend\ns\n"},"external_var":false},{"html_id":"from_slice(slice:Slice(Int32))-class-method","name":"from_slice","abstract":false,"args":[{"name":"slice","external_name":"slice","restriction":"Slice(Int32)"}],"args_string":"(slice : Slice(Int32))","args_html":"(slice : Slice(Int32))","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":15,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L15"},"def":{"name":"from_slice","args":[{"name":"slice","external_name":"slice","restriction":"Slice(Int32)"}],"visibility":"Public","body":"s = DepthStat.new\ns.n_bases = slice.size\nslice.each do |v|\n  s.sum_depth = s.sum_depth + v\n  if v < s.min_depth\n    s.min_depth = v\n  end\n  if v > s.max_depth\n    s.max_depth = v\n  end\nend\ns\n"},"external_var":false}],"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L2"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"+(other:DepthStat):DepthStat-instance-method","name":"+","abstract":false,"args":[{"name":"other","external_name":"other","restriction":"DepthStat"}],"args_string":"(other : DepthStat) : DepthStat","args_html":"(other : <a href=\"../../Depth/Stats/DepthStat.html\">DepthStat</a>) : <a href=\"../../Depth/Stats/DepthStat.html\">DepthStat</a>","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":39,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L39"},"def":{"name":"+","args":[{"name":"other","external_name":"other","restriction":"DepthStat"}],"return_type":"DepthStat","visibility":"Public","body":"result = DepthStat.new\nresult.n_bases = self.n_bases + other.n_bases\nresult.sum_depth = self.sum_depth + other.sum_depth\nresult.min_depth = {self.min_depth, other.min_depth}.min\nresult.max_depth = {self.max_depth, other.max_depth}.max\nresult\n"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":8,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L8"},"def":{"name":"clear","visibility":"Public","body":"@n_bases = 0\n@sum_depth = 0\n@min_depth = Int32::MAX\n@max_depth = 0\n"},"external_var":false},{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L2"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false},{"html_id":"max_depth:Int32-instance-method","name":"max_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L6"},"def":{"name":"max_depth","return_type":"Int32","visibility":"Public","body":"@max_depth"},"external_var":false},{"html_id":"max_depth=(max_depth:Int32)-instance-method","name":"max_depth=","abstract":false,"args":[{"name":"max_depth","external_name":"max_depth","restriction":"Int32"}],"args_string":"(max_depth : Int32)","args_html":"(max_depth : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":6,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L6"},"def":{"name":"max_depth=","args":[{"name":"max_depth","external_name":"max_depth","restriction":"Int32"}],"visibility":"Public","body":"@max_depth = max_depth"},"external_var":false},{"html_id":"min_depth:Int32-instance-method","name":"min_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L5"},"def":{"name":"min_depth","return_type":"Int32","visibility":"Public","body":"@min_depth"},"external_var":false},{"html_id":"min_depth=(min_depth:Int32)-instance-method","name":"min_depth=","abstract":false,"args":[{"name":"min_depth","external_name":"min_depth","restriction":"Int32"}],"args_string":"(min_depth : Int32)","args_html":"(min_depth : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L5"},"def":{"name":"min_depth=","args":[{"name":"min_depth","external_name":"min_depth","restriction":"Int32"}],"visibility":"Public","body":"@min_depth = min_depth"},"external_var":false},{"html_id":"n_bases:Int32-instance-method","name":"n_bases","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L3"},"def":{"name":"n_bases","return_type":"Int32","visibility":"Public","body":"@n_bases"},"external_var":false},{"html_id":"n_bases=(n_bases:Int32)-instance-method","name":"n_bases=","abstract":false,"args":[{"name":"n_bases","external_name":"n_bases","restriction":"Int32"}],"args_string":"(n_bases : Int32)","args_html":"(n_bases : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L3"},"def":{"name":"n_bases=","args":[{"name":"n_bases","external_name":"n_bases","restriction":"Int32"}],"visibility":"Public","body":"@n_bases = n_bases"},"external_var":false},{"html_id":"sum_depth:Int64-instance-method","name":"sum_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L4"},"def":{"name":"sum_depth","return_type":"Int64","visibility":"Public","body":"@sum_depth"},"external_var":false},{"html_id":"sum_depth=(sum_depth:Int64)-instance-method","name":"sum_depth=","abstract":false,"args":[{"name":"sum_depth","external_name":"sum_depth","restriction":"Int64"}],"args_string":"(sum_depth : Int64)","args_html":"(sum_depth : Int64)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/depth_stat.cr#L4"},"def":{"name":"sum_depth=","args":[{"name":"sum_depth","external_name":"sum_depth","restriction":"Int64"}],"visibility":"Public","body":"@sum_depth = sum_depth"},"external_var":false}]},{"html_id":"mos/Depth/Stats/Distribution","path":"Depth/Stats/Distribution.html","kind":"module","full_name":"Depth::Stats::Distribution","name":"Distribution","abstract":false,"locations":[{"filename":"src/depth/stats/distribution.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/distribution.cr#L4"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"instance_methods":[{"html_id":"bump_distribution!(dist:Array(Int64),a:Depth::Core::Coverage,start_i:Int32,stop_i:Int32)-instance-method","name":"bump_distribution!","abstract":false,"args":[{"name":"dist","external_name":"dist","restriction":"Array(Int64)"},{"name":"a","external_name":"a","restriction":"Depth::Core::Coverage"},{"name":"start_i","external_name":"start_i","restriction":"Int32"},{"name":"stop_i","external_name":"stop_i","restriction":"Int32"}],"args_string":"(dist : Array(Int64), a : Depth::Core::Coverage, start_i : Int32, stop_i : Int32)","args_html":"(dist : Array(Int64), a : <a href=\"../../Depth/Core/Coverage.html\">Depth::Core::Coverage</a>, start_i : Int32, stop_i : Int32)","location":{"filename":"src/depth/stats/distribution.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/distribution.cr#L5"},"def":{"name":"bump_distribution!","args":[{"name":"dist","external_name":"dist","restriction":"Array(Int64)"},{"name":"a","external_name":"a","restriction":"Depth::Core::Coverage"},{"name":"start_i","external_name":"start_i","restriction":"Int32"},{"name":"stop_i","external_name":"stop_i","restriction":"Int32"}],"visibility":"Public","body":"istop = Math.min(stop_i, a.size)\ni = start_i\nwhile i < istop\n  v = a[i]\n  if v > Depth::Core::MAX_COVERAGE\n    v = Depth::Core::MAX_COVERAGE - 10\n  end\n  if v >= dist.size\n    old = dist.size\n    new_size = v + 10\n    dist.concat(Array.new(new_size - old, 0_i64))\n  end\n  if v >= 0\n    __temp_155 = v\n    dist[__temp_155] = dist[__temp_155] + 1\n  end\n  i = i + 1\nend\n"},"external_var":false},{"html_id":"write_distribution(io:IO,chrom:String,dist:Array(Int64))-instance-method","name":"write_distribution","abstract":false,"args":[{"name":"io","external_name":"io","restriction":"::IO"},{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"dist","external_name":"dist","restriction":"Array(Int64)"}],"args_string":"(io : IO, chrom : String, dist : Array(Int64))","args_html":"(io : IO, chrom : String, dist : Array(Int64))","location":{"filename":"src/depth/stats/distribution.cr","line_number":21,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/distribution.cr#L21"},"def":{"name":"write_distribution","args":[{"name":"io","external_name":"io","restriction":"::IO"},{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"dist","external_name":"dist","restriction":"Array(Int64)"}],"visibility":"Public","body":"sum = dist.sum\nif sum < 1\n  return\nend\n\nrev = dist.dup.reverse\ncum = 0.0\nrev.each_with_index do |v, i|\n  irev = (dist.size - i) - 1\n  if irev > 300 && (v == 0)\n    next\n  end\n  cum = cum + (v.to_f / sum)\n  if cum < 8e-5\n    next\n  end\n  (((((io << chrom) << \"\\t\") << irev) << \"\\t\") << cum) << '\\n'\nend\n"},"external_var":false}]},{"html_id":"mos/Depth/Stats/IntHistogram","path":"Depth/Stats/IntHistogram.html","kind":"class","full_name":"Depth::Stats::IntHistogram","name":"IntHistogram","abstract":false,"superclass":{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mos/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mos/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/stats/count_stat.cr","line_number":3,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L3"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"doc":"Histogram-based median for integers","summary":"<p>Histogram-based median for integers</p>","constructors":[{"html_id":"new(size:Int32=65536)-class-method","name":"new","abstract":false,"args":[{"name":"size","default_value":"65536","external_name":"size","restriction":"Int32"}],"args_string":"(size : Int32 = 65536)","args_html":"(size : Int32 = <span class=\"n\">65536</span>)","location":{"filename":"src/depth/stats/count_stat.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L7"},"def":{"name":"new","args":[{"name":"size","default_value":"65536","external_name":"size","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(size)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add(value:Int32)-instance-method","name":"add","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"Int32"}],"args_string":"(value : Int32)","args_html":"(value : Int32)","location":{"filename":"src/depth/stats/count_stat.cr","line_number":12,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L12"},"def":{"name":"add","args":[{"name":"value","external_name":"value","restriction":"Int32"}],"visibility":"Public","body":"@n = @n + 1\nv = value < 0 ? raise(ArgumentError.new(\"negative depth: #{value}\")) : value\nidx = v < counts.size ? v : counts.size - 1\n__temp_153 = idx\n__temp_154 = counts\n__temp_154[__temp_153] = __temp_154[__temp_153] + 1\n"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","abstract":false,"location":{"filename":"src/depth/stats/count_stat.cr","line_number":30,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L30"},"def":{"name":"clear","visibility":"Public","body":"if n == 0\n  return\nend\n@n = 0\ncounts.fill(0)\n"},"external_var":false},{"html_id":"counts:Array(Int32)-instance-method","name":"counts","abstract":false,"location":{"filename":"src/depth/stats/count_stat.cr","line_number":4,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L4"},"def":{"name":"counts","return_type":"Array(Int32)","visibility":"Public","body":"@counts"},"external_var":false},{"html_id":"median:Int32-instance-method","name":"median","abstract":false,"location":{"filename":"src/depth/stats/count_stat.cr","line_number":19,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L19"},"def":{"name":"median","return_type":"Int32","visibility":"Public","body":"if n == 0\n  return 0\nend\nstop_n = ((n.to_f * 0.5) + 0.5).to_i\ncum = 0\ncounts.each_with_index do |cnt, i|\n  cum = cum + cnt\n  if cum >= stop_n\n    return i.to_i\n  end\nend\n0\n"},"external_var":false},{"html_id":"n:Int32-instance-method","name":"n","abstract":false,"location":{"filename":"src/depth/stats/count_stat.cr","line_number":5,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/count_stat.cr#L5"},"def":{"name":"n","return_type":"Int32","visibility":"Public","body":"@n"},"external_var":false}]},{"html_id":"mos/Depth/Stats/Quantize","path":"Depth/Stats/Quantize.html","kind":"module","full_name":"Depth::Stats::Quantize","name":"Quantize","abstract":false,"locations":[{"filename":"src/depth/stats/quantize.cr","line_number":2,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L2"}],"repository_name":"mos","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mos/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"class_methods":[{"html_id":"gen_quantized(quants:Array(Int32),coverage:Array(Int32),&block:Tuple(Int32,Int32,String)->)-class-method","name":"gen_quantized","doc":"Generate quantized depth segments\nYields tuples of (start, stop, label)","summary":"<p>Generate quantized depth segments Yields tuples of (start, stop, label)</p>","abstract":false,"args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"}],"args_string":"(quants : Array(Int32), coverage : Array(Int32), &block : Tuple(Int32, Int32, String) -> )","args_html":"(quants : Array(Int32), coverage : Array(Int32), &block : Tuple(Int32, Int32, String) -> )","location":{"filename":"src/depth/stats/quantize.cr","line_number":83,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L83"},"def":{"name":"gen_quantized","args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Tuple(Int32, Int32, String) ->)"},"visibility":"Public","body":"if coverage.empty? || quants.empty?\n  return\nend\n\nlookup = make_lookup(quants)\nif lookup.empty?\n  return\nend\n\nlast_quantized = linear_search(coverage[0], quants)\nlast_pos = 0\n\n(0...(coverage.size - 1)).each do |pos|\n  depth = coverage[pos]\n  quantized = linear_search(depth, quants)\n\n  if quantized == last_quantized\n    next\n  end\n\n  if (last_quantized != -1) && last_quantized < lookup.size\n    yield({last_pos, pos, lookup[last_quantized]})\n  end\n\n  last_quantized = quantized\n  last_pos = pos\nend\n\n\nif ((last_quantized != -1) && last_pos < (coverage.size - 1)) && last_quantized < lookup.size\n  yield({last_pos, coverage.size - 1, lookup[last_quantized]})\nend\n"},"external_var":false},{"html_id":"get_quantize_args(qa:String):Array(Int32)-class-method","name":"get_quantize_args","doc":"Parse quantize arguments string into array of integers\nExamples:\n  \":1\" -> [0, 1]\n  \"0:1:4:\" -> [0, 1, 4, Int32::MAX]","summary":"<p>Parse quantize arguments string into array of integers Examples:   &quot;:1&quot; -&gt; [0, 1]   &quot;0:1:4:&quot; -&gt; [0, 1, 4, Int32::MAX]</p>","abstract":false,"args":[{"name":"qa","external_name":"qa","restriction":"String"}],"args_string":"(qa : String) : Array(Int32)","args_html":"(qa : String) : Array(Int32)","location":{"filename":"src/depth/stats/quantize.cr","line_number":7,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L7"},"def":{"name":"get_quantize_args","args":[{"name":"qa","external_name":"qa","restriction":"String"}],"return_type":"Array(Int32)","visibility":"Public","body":"if (qa == \"nil\") || qa.empty?\n  return [] of Int32\nend\n\na = qa\n\n\nif (a.count(':')) == 0\n  a = (':' + a) + ':'\nend\n\n\nif a[0] == ':'\n  a = \"0\" + a\nend\n\n\nif a[-1] == ':'\n  a = a + Int32::MAX.to_s\nend\n\nbegin\n  qs = (a.split(':')).map(&.to_i)\n  qs.sort!\n  return qs\nrescue ex\n  STDERR.puts(\"[tanudepth] invalid quantize string: '#{qa}'\")\n  exit(2)\nend\n"},"external_var":false},{"html_id":"linear_search(q:Int32,vals:Array(Int32)):Int32-class-method","name":"linear_search","doc":"Linear search to find which bin a value belongs to\nReturns -1 if value is outside all bins","summary":"<p>Linear search to find which bin a value belongs to Returns -1 if value is outside all bins</p>","abstract":false,"args":[{"name":"q","external_name":"q","restriction":"Int32"},{"name":"vals","external_name":"vals","restriction":"Array(Int32)"}],"args_string":"(q : Int32, vals : Array(Int32)) : Int32","args_html":"(q : Int32, vals : Array(Int32)) : Int32","location":{"filename":"src/depth/stats/quantize.cr","line_number":66,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L66"},"def":{"name":"linear_search","args":[{"name":"q","external_name":"q","restriction":"Int32"},{"name":"vals","external_name":"vals","restriction":"Array(Int32)"}],"return_type":"Int32","visibility":"Public","body":"if vals.empty?\n  return -1\nend\nif q < vals[0] || q > vals[-1]\n  return -1\nend\n\nvals.each_with_index do |val, i|\n  if val > q\n    return i - 1\n  elsif val == q\n    return i\n  end\nend\n\nvals.size - 1\n"},"external_var":false},{"html_id":"make_lookup(quants:Array(Int32)):Array(String)-class-method","name":"make_lookup","doc":"Create lookup table for quantize bins\nExamples:\n  [0, 1, 4] -> [\"0:1\", \"1:4\", \"4:inf\"]","summary":"<p>Create lookup table for quantize bins Examples:   [0, 1, 4] -&gt; [&quot;0:1&quot;, &quot;1:4&quot;, &quot;4:inf&quot;]</p>","abstract":false,"args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"}],"args_string":"(quants : Array(Int32)) : Array(String)","args_html":"(quants : Array(Int32)) : Array(String)","location":{"filename":"src/depth/stats/quantize.cr","line_number":40,"url":"https://github.com/kojix2/tanudepth/blob/f379c635f75c6203f74039229c0459768003d196/src/depth/stats/quantize.cr#L40"},"def":{"name":"make_lookup","args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"}],"return_type":"Array(String)","visibility":"Public","body":"if quants.size <= 1\n  return [] of String\nend\n\nlookup = [] of String\n\n(0...(quants.size - 1)).each do |i|\n\n  env_var = \"MOSDEPTH_Q#{i}\"\n  custom_label = ENV[env_var]?\n\n  if custom_label\n    lookup << custom_label\n  elsif quants[i + 1] == Int32::MAX\n    lookup << \"#{quants[i]}:inf\"\n  else\n    lookup << \"#{quants[i]}:#{quants[i + 1]}\"\n  end\nend\n\nlookup\n"},"external_var":false}]}]}]}]}}